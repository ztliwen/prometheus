


第一、 main启动时候

localStorage  = &readyStorage{stats: tsdb.NewDBStats()}
fanoutStorage = storage.NewFanout(logger, localStorage, remoteStorage)
scrapeManager  = scrape.NewManager(&cfg.scrape, log.With(logger, "component", "scrape manager"), fanoutStorage)
err := scrapeManager.Run(discoveryManagerScrape.SyncCh())

// primary := f.primary.Appender(ctx) fanout
func (s *readyStorage) Appender(ctx context.Context) storage.Appender {
	if x := s.get(); x != nil {
		return x.Appender(ctx)
	}
	return notReadyAppender{}
}
